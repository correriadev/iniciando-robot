# .github/workflows/deploy-pages.yml
name: DEPLOY_GITHUB_PAGES

on:
  # Este gatilho (trigger) √© a forma mais robusta de encadear workflows.
  # Ele vai iniciar este workflow APENAS DEPOIS que o workflow "CI/CD Pipeline"
  # for conclu√≠do. Isso evita erros de "artefato n√£o encontrado".
  workflow_run:
    workflows: ["ROBOT_TESTS_CI"] # <-- IMPORTANTE: O nome deve ser EXATAMENTE igual ao 'name:' do seu outro arquivo de workflow.
    types:
      - completed

# Permiss√µes necess√°rias para fazer o deploy no GitHub Pages.
permissions:
  contents: read
  pages: write
  id-token: write # Essencial para as vers√µes mais recentes da action de deploy.

jobs:
  deploy:
    # Esta condi√ß√£o garante que o deploy s√≥ aconte√ßa se o workflow anterior
    # (CI/CD Pipeline) tiver sido executado com sucesso.
    if: github.event.workflow_run.conclusion == 'success'
    
    runs-on: ubuntu-latest
    
    # Configura o ambiente de deploy para o GitHub Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      # A action de checkout n√£o √© mais necess√°ria, pois vamos baixar o artefato
      # diretamente do outro workflow.

      - name: ‚¨áÔ∏è Download artifact from the completed workflow
        uses: actions/download-artifact@v4
        with:
          # O nome do artefato deve ser o mesmo usado no 'upload-artifact'
          # do seu workflow de CI/CD.
          name: robot-logs
          path: public # Baixa os arquivos para uma pasta 'public'
          
          # Informa √† action de qual execu√ß√£o de workflow baixar o artefato.
          github-token: ${{ secrets.ACTIONS_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}

      - name: ‚öôÔ∏è Configure Pages
        uses: actions/configure-pages@v5 # <-- ATUALIZADO

      - name: üì¶ Upload Pages artifact
        uses: actions/upload-pages-artifact@v3 # <-- ATUALIZADO
        with:
          # Faz o upload da pasta que cont√©m os logs para o GitHub Pages
          path: ./public

      - name: üì¢ Publish to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # <-- ATUALIZADO
# .github/workflows/deploy-pages.yml
name: ðŸš€ Deploy Test Reports to GitHub Pages

on:
  # Este gatilho (trigger) Ã© a forma mais robusta de encadear workflows.
  # Ele vai iniciar este workflow APENAS DEPOIS que o workflow "CI/CD Pipeline"
  # for concluÃ­do. Isso evita erros de "artefato nÃ£o encontrado".
  workflow_run:
    workflows: ["robot_tests_ci"] # <-- IMPORTANTE: O nome deve ser EXATAMENTE igual ao 'name:' do seu outro arquivo de workflow.
    types:
      - completed

# PermissÃµes necessÃ¡rias para fazer o deploy no GitHub Pages.
permissions:
  contents: read
  pages: write
  id-token: write # Essencial para as versÃµes mais recentes da action de deploy.

jobs:
  deploy:
    # Esta condiÃ§Ã£o garante que o deploy sÃ³ aconteÃ§a se o workflow anterior
    # (CI/CD Pipeline) tiver sido executado com sucesso.
    if: github.event.workflow_run.conclusion == 'success'
    
    runs-on: ubuntu-latest
    
    # Configura o ambiente de deploy para o GitHub Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      # A action de checkout nÃ£o Ã© mais necessÃ¡ria, pois vamos baixar o artefato
      # diretamente do outro workflow.

      - name: â¬‡ï¸ Download artifact from the completed workflow
        uses: actions/download-artifact@v4
        with:
          # O nome do artefato deve ser o mesmo usado no 'upload-artifact'
          # do seu workflow de CI/CD.
          name: robot-logs
          path: public # Baixa os arquivos para uma pasta 'public'
          
          # Informa Ã  action de qual execuÃ§Ã£o de workflow baixar o artefato.
          github-token: ${{ secrets.ACTIONS_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}

      - name: âš™ï¸ Configure Pages
        uses: actions/configure-pages@v5 # <-- ATUALIZADO

      - name: ðŸ“¦ Upload Pages artifact
        uses: actions/upload-pages-artifact@v3 # <-- ATUALIZADO
        with:
          # Faz o upload da pasta que contÃ©m os logs para o GitHub Pages
          path: ./public

      - name: ðŸ“¢ Publish to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # <-- ATUALIZADO